# Johnson's Relative Weights

Веб-приложение для расчёта относительных весов предикторов (Johnson's Relative Weights) с множественной импутацией пропущенных значений.

## Что это?

Johnson's Relative Weights — это метод, который позволяет определить вклад каждой независимой переменной в объяснение дисперсии зависимой переменной. В отличие от стандартных коэффициентов регрессии, относительные веса корректно распределяют объяснённую дисперсию между коррелирующими предикторами.

## Возможности

- Загрузка SPSS (.sav) файлов
- Автоматическое определение переменных
- Три метода импутации пропущенных значений:
  - **MICE** (Multiple Imputation by Chained Equations) — наиболее точный
  - **Hybrid** — баланс скорости и точности
  - **Simple Mean** — простая замена средними
- Расчёт по подгруппам (например, по брендам или регионам)
- Результаты в Excel и CSV форматах

## Локальный запуск

### Требования
- Python 3.11+
- pip

### Установка

```bash
# Клонируйте репозиторий
git clone <repository-url>
cd JohnsonsBot

# Создайте виртуальное окружение
python -m venv .venv
source .venv/bin/activate  # Linux/Mac
# или .venv\Scripts\activate  # Windows

# Установите зависимости
pip install -r requirements.txt
```

### Запуск

```bash
python app.py
```

Приложение будет доступно по адресу: http://localhost:8000

## Деплой на Koyeb

### Рекомендуемый инстанс
- **eSmall** (1 ГБ RAM, 0.5 eCPU) — ~$5/месяц
- Для больших файлов: **Small** (2 ГБ RAM) — ~$10/месяц

### Шаги деплоя

1. Создайте аккаунт на [Koyeb](https://www.koyeb.com/)

2. Создайте новый сервис:
   - Source: GitHub
   - Repository: ваш репозиторий
   - Builder: Dockerfile
   - Instance type: eSmall или Small

3. Настройки:
   - Port: 8000
   - Health check path: `/health`

4. Нажмите Deploy

### Переменные окружения (опционально)
- `PORT` — порт приложения (Koyeb устанавливает автоматически)
- `APP_HOST` — хост (по умолчанию 0.0.0.0)

## Использование

1. **Загрузите файл** — SPSS (.sav) с вашими данными
2. **Выберите переменные**:
   - Зависимые переменные (что объясняем)
   - Независимые переменные (чем объясняем, минимум 2)
   - Подгруппы (опционально)
3. **Запустите расчёт** — дождитесь завершения
4. **Скачайте результаты** — Excel или CSV

## Структура результатов

Файл результатов содержит:
- `Imputation Method` — метод импутации
- `Dependent Variable` — зависимая переменная
- `R-squared` — коэффициент детерминации
- `Weight_*` — абсолютные веса каждого предиктора
- `Percentage_*` — процентный вклад каждого предиктора

## Технические детали

- **Backend**: Flask + Gunicorn
- **Data processing**: pandas, pyreadstat
- **Machine Learning**: scikit-learn (IterativeImputer для MICE)
- **Container**: Docker

## Лицензия

MIT
