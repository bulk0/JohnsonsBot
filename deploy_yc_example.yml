name: üöÄ –î–µ–ø–ª–æ–π –≤ Yandex Cloud

# –ó–∞–ø—É—Å–∫ –ø—Ä–∏ –ø—É—à–µ –≤ –≤–µ—Ç–∫—É main
on:
  push:
    branches:
      - main

jobs:
  deploy:
    name: üîß –í—ã–ø–æ–ª–Ω–∏—Ç—å —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ
    runs-on: ubuntu-latest

    steps:
      # 1. –ü–æ–ª—É—á–∏—Ç—å –∫–æ–¥ –∏–∑ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è
      - name: üì¶ –ü–æ–ª—É—á–∏—Ç—å –∫–æ–¥
        uses: actions/checkout@v4

      # 2. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å YC CLI
      - name: üîß –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å YC CLI
        run: |
          curl -sSL https://storage.yandexcloud.net/yandexcloud-yc/install.sh | bash
          echo "$HOME/.yc/bin" >> $GITHUB_PATH

      # 3. –ù–∞—Å—Ç—Ä–æ–∏—Ç—å –ø—Ä–æ—Ñ–∏–ª—å Yandex Cloud —Å –ø–æ–º–æ—â—å—é —Å–µ—Ä–≤–∏—Å–Ω–æ–≥–æ –∞–∫–∫–∞—É–Ω—Ç–∞
      - name: üîê –ù–∞—Å—Ç—Ä–æ–∏—Ç—å –¥–æ—Å—Ç—É–ø –∫ Yandex Cloud
        uses: yandex-cloud/actions/configure@v1
        with:
          cloud-id: ${{ secrets.YC_CLOUD_ID }}
          folder-id: ${{ secrets.YC_FOLDER_ID }}
          key-id: ${{ secrets.YC_SERVICE_ACCOUNT_KEY_ID }}
          service-account-key: ${{ secrets.YC_SERVICE_ACCOUNT_SECRET_KEY }}

      # 4. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ –≤—Å—ë —Ä–∞–±–æ—Ç–∞–µ—Ç ‚Äî –ø–æ–ª—É—á–∏—Ç—å —Å–ø–∏—Å–æ–∫ –í–ú
      - name: üñ•Ô∏è –ü–æ–∫–∞–∑–∞—Ç—å —Å–ø–∏—Å–æ–∫ –≤–∏—Ä—Ç—É–∞–ª—å–Ω—ã—Ö –º–∞—à–∏–Ω
        run: yc compute instance list

      # üî• –ü—Ä–∏–º–µ—Ä: –î–µ–ø–ª–æ–π –ø—Ä–æ—Å—Ç–æ–≥–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è (Node.js)
      # –†–∞—Å–∫–æ–º–º–µ–Ω—Ç–∏—Ä—É–π—Ç–µ, –µ—Å–ª–∏ –Ω—É–∂–Ω–æ —Å–æ–±—Ä–∞—Ç—å –∏ –∑–∞–ø—É—Å—Ç–∏—Ç—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ

      # - name: –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å Node.js
      #   uses: actions/setup-node@v4
      #   with:
      #     node-version: '18'

      # - name: –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
      #   run: npm install

      # - name: –°–æ–±—Ä–∞—Ç—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
      #   run: npm run build

      # - name: –ó–∞–≥—Ä—É–∑–∏—Ç—å –Ω–∞ –í–ú –∏–ª–∏ –≤ Functions (–ø—Ä–∏–º–µ—Ä –Ω–∏–∂–µ)
      #   run: yc serverless function version create --name my-function --runtime nodejs18 --entrypoint index.handler --memory 256m --source-path ./dist

      # üåê –ò–ª–∏: –î–µ–ø–ª–æ–π —Å—Ç–∞—Ç–∏–∫–∏ –≤ Object Storage (s3)
      # - name: –ó–∞–≥—Ä—É–∑–∏—Ç—å —Å—Ç–∞—Ç–∏–∫—É –≤ Storage
      #   run: |
      #     yc storage cp --recursive dist/* s3://your-bucket-name/

      # üß™ –ü—Ä–∏–º–µ—Ä: –ó–∞–ø—É—Å—Ç–∏—Ç—å —Ç–µ—Å—Ç—ã
      - name: üß™ –ó–∞–ø—É—Å—Ç–∏—Ç—å —Ç–µ—Å—Ç—ã
        run: echo "–¢–µ—Å—Ç—ã –∑–∞–ø—É—â–µ–Ω—ã!"
